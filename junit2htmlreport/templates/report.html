{% extends "base.html" %}
{% block content %}
<header>
    <section class="left">
        <h1>Test Report : {{ report.title }}</h1>
    </section>
    <section class="right">
        <section id="counters">
            <h2 id="test-count"><span class="number">
                {% set tests = [] %}
                {% for suite in report %}
                    {% for classname in suite.classes %}
                        {%if tests.append(suite.classes[classname].cases | length) %}{% endif %}
                    {% endfor %}
                {% endfor %}
                {{tests | sum}}

            </span> tests</h2>
            <h2 id="fail-count"><span class="number">
                {% set tests = [] %}
                {% for suite in report %}
                    {%if tests.append(suite.failed() | length) %}{% endif %}
                {% endfor %}
                {{tests | sum}}
            </span> failures</h2>

        </section>
        <section id="segment-bar">
            <a id="all-segment" onclick="selectSegment(this);" class="selected">All</a>
            <a id="failing-segment" onclick="selectSegment(this);">Failing</a>
            <a id="passing-segment" onclick="selectSegment(this);">Passing</a>
        </section>
    </section>
</header>

<section id="test-suites">
    {% for suite in report %}
        {% if suite.failed() %}
        <div class="testsuite testsuite-failed">
        {% else %}
        <div class="testsuite testsuite-passed">
        {% endif %}
            <section class="testsuite-header" onclick=toggleTests(this);><h2>Test Suite: {{ suite.name }}</h2></section>
            <section>
                <a id="{{ suite.anchor() }}"></a>
                {% if suite.package %}
                <span>Package: {{suite.package}}</span>
                {% endif %}
                {% if suite.properties %}
                <h3>Suite Properties</h3>
                <table class="proplist">
                    {% for prop in suite.properties %}
                    <tr>
                        <th>{{prop.name}}</th><td>{{prop.value}}</td>
                    </tr>
                    {% endfor %}
                </table>
                {% endif %}
                <div class="testresults">
                    <h3>Results</h3>
                    {% if suite.failed() %}
                    <div class="testsuite-results-failed">
                    {% else %}
                    <div class="testsuite-results-passed">
                    {% endif %}
                        <table class="proplist">
                            <tr>
                                <th>Duration</th><td>{{suite.duration |round(1)}} sec</td>
                            </tr>
                            <tr>
                                <th>Tests</th><td>{{suite.all() |length}}</td>
                            </tr>
                            <tr>
                                <th>Failures</th><td>{{suite.failed()| length}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
    
                <div class="testclasses">
                    <h3>Tests</h3>
                    {% for classname in suite.classes %}
                    {% if suite.classes[classname].failed() %}
                    <div class="testclass testclass-failed">
                    {% else %}
                    <div class="testclass testclass-passed">
                    {% endif %}
                        <section class="header" onclick=toggleTests(this);><h4>{{classname}}</h4></section>
                        <section>
                            <table class="testcases">
                                {% for test in suite.classes[classname].cases %}
                                <tr class="test outcome outcome-{{test.outcome()}} proplist">
                                    <a id="{{test.anchor()}}"></a>
                                    <td>
                                        <table>
                                            <tr>
                                                <td><h4>{{test.duration|round(1)}} sec</h4></td>
                                                <td><h4>{{test.name}}</h4></td>
                                            </tr>
    
                                            {% if test.skipped %}
                                            <tr><td colspan="2">Skipped </td></tr>
                                            {% endif %}
                
                                            {% if test.failed() %}
                                            <tr><td colspan="2"><pre>{{test.failure}}</pre> </td></tr>
                                            {% endif %}
    
                                            {% if test.skipped %}
                                            <tr><td colspan="2"><pre>{{test.skipped}}</pre> </td></tr>
                                            {% endif %}
                
                                            {% if test.properties %}
                                            <tr><td colspan="2">
                                                <table class="proplist">
                                                    {% for prop in test.properties %}
                                                    <tr>
                                                        <th>{{prop.name}}</th><td>{{prop.value}}</td>
                                                    </tr>
                                                    {% endfor %}
                                                </table>
                                            </td></tr>
                                            {% endif %}
    
                                            {% if test.stdout %}
                                            <tr><td colspan="2">
                                                <div class="stdout"><i>Stdout</i><br>
                                                    <pre>{{test.stdout}}</pre>
                                                </div>
                                            </td></tr>
                                            {% endif %}
                                            
                                            {% if test.stderr %}
                                            <tr><td colspan="2">
                                                <div class="stderr"><i>Stderr</i><br>
                                                    <pre>{{test.stderr}}</pre>
                                                </div>
                                            </td></tr>
                                            {% endif %}
                                        </table>
                                    </td>
                                </tr>
                                {% endfor %}
                            </table>
                        </section>
                    </div>
                    {% endfor %}
                </div>
            </section>
        </div>
        {% if suite.stdout or suite.stderr %}
            <h3>Suite stdout:</h3>
            <pre class="stdio">{{suite.stdout}}</pre>
            <h3>Suite stderr:</h3>
            <pre class="stdio">{{suite.stderr}}</pre>
        {% endif %}
    {% endfor %}
    {% endblock %}
</section>